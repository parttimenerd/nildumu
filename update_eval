#!/usr/bin/env sh
set -e
case "$(uname -s)" in
   Darwin)
     SCRIPT_PATH=$(greadlink -f "$0")
     ;;

   *)
     SCRIPT_PATH=$(readlink -f "$0")
     ;;
esac

PROJECT_DIR=$(dirname "$SCRIPT_PATH")

cd "$PROJECT_DIR"

echo "check for solvers"
./download_solvers > /dev/null

echo "build evaluation jar"
mvn compile -DskipTests=true > /dev/null
mvn package -DskipTests=true > /dev/null

echo "build evaluated jar"
mvn package -f pom2.xml -DskipTests=true > /dev/null
cp target/nildumu-minimal-jar-with-dependencies.jar eval-programs/nildumu.jar

git submodule update --recursive --remote
#(cd eval-programs/approxflow; git checkout master; git pull)

echo "build modified cbmc"
(cd bin; rm -fr modified_cbmc/build; ./build > /dev/null)

